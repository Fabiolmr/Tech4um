{% extends 'base.html' %}

{% block content %}

<header class="header">
    <div class="header-left">
        <div class="logo">TECH4UM</div>
        <button class="participants-toggle" onclick="toggleParticipants()">
            <!-- Ícone de pessoas -->
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="white" viewBox="0 0 24 24">
                <path d="M16 14c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-8 0c2.21 0 4-1.79 4-4S10.21 6 8 6 4 7.79 4 10s1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h12v-2c0-2.66-5.33-4-8-4zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 2.01 1.97 3.45v1.5h8v-2c0-2.66-5.33-4-8-4z"/>
            </svg>
        </button>
    </div>
</header>

<!-- SIDEBAR PADRÃO -->
<div class="sidebar">
    <div class="user-info">
        <p>@{{ username }}</p>
        <button onclick="window.location.href='/logout'">Sair</button>
    </div>

    <div class="sidebar-section">
        <ul>
            <li onclick="window.location.href='/feed'">
                <img src="/static/icons/list.svg" class="sideicon" alt=""> Feed
            </li>
            <li onclick="window.location.href='/forums'">
                <img src="/static/icons/forum.svg" class="sideicon" alt=""> Fóruns
            </li>
            <li onclick="window.location.href='/settings'">
                <img src="/static/icons/settings.svg" class="sideicon" alt=""> Configurações
            </li>
        </ul>
    </div>
</div>

<!-- ÁREA DO CHAT -->
<div class="chat-wrapper">

    <div class="chat-area">

        <div class="chat-header">
            <h2>CHAT - {{ room }}</h2>
        </div>

        <div class="chat-messages" id="messages">
            {% for msg in messages %}
                {% if msg.user == username %}
                    <div class="msg msg-me">
                        <p class="msg-text">{{ msg.text }}</p>
                        <span class="msg-user">@{{ msg.user }}</span>
                    </div>
                {% else %}
                    <div class="msg msg-other">
                        <span class="msg-user">@{{ msg.user }}</span>
                        <p class="msg-text">{{ msg.text }}</p>
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <form method="POST" action="/send/{{ room }}" class="chat-input">
            <input type="text" name="message" placeholder="Digite sua mensagem..." autocomplete="off">
            <button type="submit">Enviar</button>
        </form>

    </div>

</div>

<!-- PANEL DESLIZANTE PARTICIPANTES -->
<div class="participants-panel" id="participantsPanel">
    <div class="participants-header">
        <h3>PARTICIPANTES</h3>
        <button onclick="toggleParticipants()" class="close-btn">&times;</button>
    </div>
    <div class="participants-list">
        {% for p in participantes %}
            <p>@{{ p.username }}</p>
        {% endfor %}
    </div>
</div>

<script>
    const messagesDiv = document.getElementById('messages');
    messagesDiv.scrollTop = messagesDiv.scrollHeight;

    function toggleParticipants() {
        const panel = document.getElementById('participantsPanel');
        if (panel.classList.contains('open')) {
            panel.classList.remove('open');
        } else {
            panel.classList.add('open');
        }
    }
</script>

{% endblock %}
