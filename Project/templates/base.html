<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech4um | {% block title %}{% endblock %}</title>

    {# O Tailwind CSS √© carregado nas p√°ginas filhas para evitar conflitos #}
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
             crossorigin="anonymous"></script>
    
    <style>
        /* =======================================================
           DEFINI√á√ïES DE TEMA (Vari√°veis CSS)
           =======================================================
           Usamos CSS Variables para permitir a altern√¢ncia de cores de tema.
        */
        :root {
            /* MODO ESCURO (Padr√£o) */
            --color-primary: #FF4500; 
            --color-secondary: #E63E00;
            --color-background: #1F2937;
            --color-sidebar-bg: #111827;
            --color-card-bg: #374151;
            --color-text-main: #F3F4F6;
            --color-border-dark: #4B5563;
            --color-muted: #9CA3AF;
            
            /* Alertas */
            --alert-success-bg: #d1fae5;
            --alert-success-text: #065f46;
            --alert-danger-bg: #fee2e2;
            --alert-danger-text: #991b1b;
            --alert-info-bg: #dbeafe;
            --alert-info-text: #1e40af;
        }

        /* MODO CLARO (Inverte Cores) */
        body.light-mode {
            --color-primary: #E63E00;
            --color-secondary: #FF4500;
            --color-background: #F3F4F6;
            --color-sidebar-bg: #FFFFFF;
            --color-card-bg: #FFFFFF;
            --color-text-main: #1F2937;
            --color-border-dark: #D1D5DB;
            --color-muted: #6B7280;
            
            /* Alertas do modo claro */
            --alert-success-bg: #D1FAE5;
            --alert-success-text: #065F46;
            --alert-danger-bg: #FEE2E2;
            --alert-danger-text: #991B1B;
            --alert-info-bg: #DBEAFE;
            --alert-info-text: #1E40AF;
        }

        /* =======================================================
           ESTILOS BASE DA P√ÅGINA (Aplicam as vari√°veis)
           =======================================================
        */
        body {
            background-color: var(--color-background);
            color: var(--color-text-main);
            margin: 0;
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s;
        }

        /* HEADER FIXO */
        header {
            background-color: var(--color-sidebar-bg);
            border-bottom: 1px solid var(--color-border-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1rem;
            height: 60px;
            width: 100%;
            position: fixed;
            top: 0;
            z-index: 100;
            transition: background-color 0.3s, border-color 0.3s;
        }

        header .logo {
            color: var(--color-primary);
            font-size: 1.5rem;
            font-weight: bold;
            text-decoration: none;
        }

        .header-right {
            display: flex; 
            align-items: center;
            gap: 10px;
        }

        /* Estilo base do Bot√£o de Tema */
        .btn-header {
            background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            text-decoration: none;
            transition: opacity 0.2s, box-shadow 0.2s;
        }
        
        /* Estilos de Flash Messages usando vari√°veis din√¢micas */
        .flash-messages {
             padding-top: 1rem;
             padding-left: 1rem;
             padding-right: 1rem;
             max-width: 800px;
             margin: 0 auto;
        }

        .alert {
            padding: 0.75rem;
            border-radius: 0.25rem;
            margin-bottom: 10px;
        }

        .alert-success { background-color: var(--alert-success-bg); color: var(--alert-success-text); }
        .alert-danger, .alert-error { background-color: var(--alert-danger-bg); color: var(--alert-danger-text); }
        .alert-info { background-color: var(--alert-info-bg); color: var(--alert-info-text); }

        .content {
            padding-top: 70px; /* Garante que o conte√∫do comece abaixo do header */
        }

    </style>

</head>

<body>

    <header>
        <a href="{{ url_for('main.home') }}" class="logo">TecH4um</a>
        
        <div class="header-right">
            <button id="theme-toggle" class="btn-header" style="font-weight: normal;">
                üåô Tema Escuro 
            </button>
            
            {% block header_actions %}{% endblock %}
        </div>
    </header>

    <div class="content">
        {# FLASH MESSAGES #}
        <div class="flash-messages">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div style="text-align: center; margin-bottom: 20px;">
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}
        </div>

        {% block content %}{% endblock %}
    </div>

    {# Script de Toggle de Tema #}
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const toggleButton = document.getElementById('theme-toggle');
        const body = document.body;

        // Fun√ß√£o principal para aplicar/remover a classe
        function applyTheme(theme) {
            if (theme === 'light') {
                body.classList.add('light-mode');
                // Altera o texto do bot√£o para sugerir a A√á√ÉO de mudar para o tema ESCURO
                if (toggleButton) toggleButton.innerHTML = 'üåô Tema Escuro'; 
            } else {
                // Tema 'dark'
                body.classList.remove('light-mode');
                // Altera o texto do bot√£o para sugerir a A√á√ÉO de mudar para o tema CLARO
                if (toggleButton) toggleButton.innerHTML = '‚òÄÔ∏è Tema Claro'; 
            }
        }

        // 1. Tenta carregar o tema salvo ou usa 'dark' como padr√£o.
        const savedTheme = localStorage.getItem('theme') || 'dark';
        applyTheme(savedTheme);

        // 2. Listener do bot√£o
        if (toggleButton) {
            toggleButton.addEventListener('click', () => {
                const isLight = body.classList.contains('light-mode');
                const newTheme = isLight ? 'dark' : 'light';
                
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });
        }
    });

    // Fun√ß√£o dummy para evitar erros de refer√™ncia em p√°ginas filhas (Home)
    function toggleCreateForum() {
         const box = document.getElementById("create-forum-box");
         if (box) box.classList.toggle("hidden");
    }
    
    // Para resolver erros de refer√™ncia no Jinja2 (se houver)
    function url_for(endpoint, params) {
        // Implementa√ß√£o dummy ou substitua por uma fun√ß√£o Flask real se necess√°rio
        let url = endpoint;
        if (params) {
            url += '?' + Object.keys(params).map(key => key + '=' + params[key]).join('&');
        }
        return url;
    }
    </script>
</body>
</html>